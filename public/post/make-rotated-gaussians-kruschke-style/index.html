<!DOCTYPE html>
<html lang="en-us">
<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="generator" content="Source Themes Academic 2.4.0">
  <meta name="generator" content="Hugo 0.49" />
  <meta name="author" content="A. Solomon Kurz">

  
  
  
  
    
  
  <meta name="description" content="tl;dr You too can make sideways Gaussian density curves within the tidyverse. Here’s how.
 Here’s the deal: I like making pictures. Over the past several months, I’ve been slowly chipping away at John Kruschke’s Doing Bayesian data analysis, Second Edition: A tutorial with R, JAGS, and Stan. Kruschke has a unique plotting style. One of the quirks is once in a while he likes to express the results of his analyses in plots where he shows the data alongside density curves of the model-implied data-generating distributions.">

  
  <link rel="alternate" hreflang="en-us" href="/post/make-rotated-gaussians-kruschke-style/">

  


  

  

  

  
  
  
  <meta name="theme-color" content="#0095eb">
  

  
  
  
  
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha256-eSi1q2PG6J7g7ib17yAaWMcrr5GrtohYChqibrV7PBE=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/academicons/1.8.6/css/academicons.min.css" integrity="sha256-uFVgMKfistnJAfoCUQigIl+JfUaP47GrRKjf6CTPVmw=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.3.1/css/all.css" integrity="sha384-mzrmE5qonljUremFsqc01SB46JvROS7bZs3IO2EmfFsd15uHvIt+Y8vEf7N7fWAU" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.2.5/jquery.fancybox.min.css" integrity="sha256-ygkqlh3CYSUri3LhQxzdcm0n1EQvH2Y+U5S2idbLtxs=" crossorigin="anonymous">

    
    
    
      
    
    
      
      
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css" crossorigin="anonymous">
      
    

    

    

  

  
  
  <link rel="stylesheet" href=//fonts.googleapis.com/css?family=Montserrat:400,700|Roboto:400,400italic,700|Roboto+Mono>
  

  <link rel="stylesheet" href="/styles.css">
  

  
  
  

  
  <link rel="alternate" href="/index.xml" type="application/rss+xml" title="A. Solomon Kurz">
  <link rel="feed" href="/index.xml" type="application/rss+xml" title="A. Solomon Kurz">
  

  <link rel="manifest" href="/site.webmanifest">
  <link rel="icon" type="image/png" href="/img/icon.png">
  <link rel="apple-touch-icon" type="image/png" href="/img/icon-192.png">

  <link rel="canonical" href="/post/make-rotated-gaussians-kruschke-style/">

  <meta property="twitter:card" content="summary_large_image">
  
  <meta property="twitter:site" content="@SolomonKurz">
  <meta property="twitter:creator" content="@SolomonKurz">
  
  <meta property="og:site_name" content="A. Solomon Kurz">
  <meta property="og:url" content="/post/make-rotated-gaussians-kruschke-style/">
  <meta property="og:title" content="Make rotated Gaussians, Kruschke style | A. Solomon Kurz">
  <meta property="og:description" content="tl;dr You too can make sideways Gaussian density curves within the tidyverse. Here’s how.
 Here’s the deal: I like making pictures. Over the past several months, I’ve been slowly chipping away at John Kruschke’s Doing Bayesian data analysis, Second Edition: A tutorial with R, JAGS, and Stan. Kruschke has a unique plotting style. One of the quirks is once in a while he likes to express the results of his analyses in plots where he shows the data alongside density curves of the model-implied data-generating distributions.">
  
  
    
  <meta property="og:image" content="/img/Solomon%20at%20Double%20Decker.jpg">
  <meta property="og:locale" content="en-us">
  
  <meta property="article:published_time" content="2018-12-20T00:00:00&#43;00:00">
  
  <meta property="article:modified_time" content="2018-12-20T00:00:00&#43;00:00">
  

  

  

  <title>Make rotated Gaussians, Kruschke style | A. Solomon Kurz</title>

</head>
<body id="top" data-spy="scroll" data-target="#TableOfContents" data-offset="71" >

<nav class="navbar navbar-light fixed-top navbar-expand-lg py-0" id="navbar-main">
  <div class="container">

    
      <a class="navbar-brand" href="/">A. Solomon Kurz</a>
      
      <button type="button" class="navbar-toggler" data-toggle="collapse"
              data-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
        <span><i class="fas fa-bars"></i></span>
      </button>
      

    
    <div class="collapse navbar-collapse" id="navbar">

      
      
      <ul class="navbar-nav ml-auto">
        

        

        
        
        
          
        

        <li class="nav-item">
          <a class="nav-link" href="/#about">
            
            <span>Home</span>
            
          </a>
        </li>

        
        

        

        
        
        
          
        

        <li class="nav-item">
          <a class="nav-link" href="/post/">
            
            <span>Blog posts</span>
            
          </a>
        </li>

        
        

        

        
        
        
          
        

        <li class="nav-item">
          <a class="nav-link" href="/bookdown/">
            
            <span>Book-length projects</span>
            
          </a>
        </li>

        
        

        

        
        
        
          
        

        <li class="nav-item">
          <a class="nav-link" href="/teaching/">
            
            <span>Teaching</span>
            
          </a>
        </li>

        
        

      

        

        
      </ul>

    </div>
  </div>
</nav>


<article class="article" itemscope itemtype="http://schema.org/Article">

  





  <div class="article-container">
    <h1 itemprop="name">Make rotated Gaussians, Kruschke style</h1>

    

<div class="article-metadata">

  
  
  <span itemscope itemprop="author" itemtype="http://schema.org/Person">
    <meta itemprop="name" content="A. Solomon Kurz">
  </span>
  

  <span class="article-date">
    
    <meta content="2018-12-20 00:00:00 &#43;0000 UTC" itemprop="datePublished">
    <time datetime="2018-12-20 00:00:00 &#43;0000 UTC" itemprop="dateModified">
      Dec 20, 2018
    </time>
  </span>
  <span itemscope itemprop="publisher" itemtype="http://schema.org/Person">
    <meta itemprop="name" content="A. Solomon Kurz">
  </span>

  
  <span class="middot-divider"></span>
  <span class="article-reading-time">
    15 min read
  </span>
  

  
  

  
  
  
  

  
  
<div class="share-box" aria-hidden="true">
  <ul class="share">
    <li>
      <a class="twitter"
         href="https://twitter.com/intent/tweet?text=Make%20rotated%20Gaussians%2c%20Kruschke%20style&amp;url=%2fpost%2fmake-rotated-gaussians-kruschke-style%2f"
         target="_blank" rel="noopener">
        <i class="fab fa-twitter"></i>
      </a>
    </li>
    <li>
      <a class="facebook"
         href="https://www.facebook.com/sharer.php?u=%2fpost%2fmake-rotated-gaussians-kruschke-style%2f"
         target="_blank" rel="noopener">
        <i class="fab fa-facebook-f"></i>
      </a>
    </li>
    <li>
      <a class="linkedin"
         href="https://www.linkedin.com/shareArticle?mini=true&amp;url=%2fpost%2fmake-rotated-gaussians-kruschke-style%2f&amp;title=Make%20rotated%20Gaussians%2c%20Kruschke%20style"
         target="_blank" rel="noopener">
        <i class="fab fa-linkedin-in"></i>
      </a>
    </li>
    <li>
      <a class="weibo"
         href="http://service.weibo.com/share/share.php?url=%2fpost%2fmake-rotated-gaussians-kruschke-style%2f&amp;title=Make%20rotated%20Gaussians%2c%20Kruschke%20style"
         target="_blank" rel="noopener">
        <i class="fab fa-weibo"></i>
      </a>
    </li>
    <li>
      <a class="email"
         href="mailto:?subject=Make%20rotated%20Gaussians%2c%20Kruschke%20style&amp;body=%2fpost%2fmake-rotated-gaussians-kruschke-style%2f">
        <i class="fas fa-envelope"></i>
      </a>
    </li>
  </ul>
</div>


  

</div>


    <div class="article-style" itemprop="articleBody">
      <div id="tldr" class="section level2">
<h2>tl;dr</h2>
<p>You too can make sideways Gaussian density curves within the tidyverse. Here’s how.</p>
</div>
<div id="heres-the-deal-i-like-making-pictures." class="section level2">
<h2>Here’s the deal: I like making pictures.</h2>
<p>Over the past several months, I’ve been slowly chipping away at John Kruschke’s <a href="https://sites.google.com/site/doingbayesiandataanalysis/"><em>Doing Bayesian data analysis, Second Edition: A tutorial with R, JAGS, and Stan</em></a>. Kruschke has a unique plotting style. One of the quirks is once in a while he likes to express the results of his analyses in plots where he shows the data alongside density curves of the model-implied data-generating distributions. Here’s an example from chapter 19 (p. 563).</p>
<div class="figure">
<img src="/img/Kruschke_sideways_Gaussians.png" />

</div>
<p>In this example, he has lifespan data (i.e., <code>Longevity</code>) for fruit flies from five experimental conditions (i.e., <code>CompanionNumber</code>). Those are the black circles. In this section of the chapter, he used a Gaussian multilevel model in which the mean value for <code>Longevity</code> had a grand mean in addition to random effects for the five experimental conditions. Those sideways-turned blue Gaussians are his attempt to express the model-implied data generating distributions for each group.</p>
<p>If you haven’t gone through Kruschke’s text, you should know he relies on base R and all its <a href="https://bookdown.org/rdpeng/rprogdatascience/control-structures.html#for-loops">loop</a>y glory. If you carefully go through his code, you can reproduce his plots in that fashion. I’m a <a href="https://www.tidyverse.org">tidyverse</a> man and prefer to avoid writing a <code>for()</code> loop at all costs. At first, I tried to work with convenience functions within ggplot2 and friends, but only had limited success. After staring long and hard at Kruschke’s base code, I came up with a robust solution, which I’d like to share here.</p>
<p>In this post, we’ll practice making sideways Gaussians in the Kruschke style. We’ll do so with a simple intercept-only single-level model and then expand our approach to an intercept-only multilevel model like the one in the picture, above.</p>
</div>
<div id="my-assumptions" class="section level2">
<h2>My assumptions</h2>
<p>For the sake of this post, I’m presuming you’re familiar with <a href="https://bookdown.org/rdpeng/rprogdatascience/history-and-overview-of-r.html">R</a>, aware of the <a href="https://www.rstudio.com/resources/videos/data-science-in-the-tidyverse/">tidyverse</a>, and have fit a <a href="https://www.youtube.com/watch?v=4WVelCswXo4">Bayesian model</a> or two. Yes. I admit that’s a narrow crowd. Sometimes the target’s a small one.</p>
</div>
<div id="we-need-data." class="section level2">
<h2>We need data.</h2>
<p>First, we need data. Here we’ll borrow code from Matthew Kay’s nice <a href="https://mjskay.github.io/tidybayes/articles/tidy-brms.html">tutorial</a> on how to use his great <a href="https://github.com/mjskay/tidybayes">tidybayes package</a>.</p>
<pre class="r"><code>library(tidyverse)

set.seed(5)
n           &lt;- 10
n_condition &lt;- 5

abc &lt;-
  tibble(condition = rep(letters[1:5], times = n),
         response  = rnorm(n * 5, mean = c(0, 1, 2, 1, -1), sd = 0.5))</code></pre>
<p>The data structure looks like so.</p>
<pre class="r"><code>str(abc)</code></pre>
<pre><code>## Classes &#39;tbl_df&#39;, &#39;tbl&#39; and &#39;data.frame&#39;:    50 obs. of  2 variables:
##  $ condition: chr  &quot;a&quot; &quot;b&quot; &quot;c&quot; &quot;d&quot; ...
##  $ response : num  -0.42 1.692 1.372 1.035 -0.144 ...</code></pre>
<p>With Kay’s code, we have <code>response</code> values for five <code>condition</code>s. All follow the normal distribution and share a common standard deviation. However, they differ in their group means.</p>
<pre class="r"><code>abc %&gt;% 
  group_by(condition) %&gt;% 
  summarise(mean = mean(response) %&gt;% round(digits = 2))</code></pre>
<pre><code>## # A tibble: 5 x 2
##   condition  mean
##   &lt;chr&gt;     &lt;dbl&gt;
## 1 a          0.18
## 2 b          1.01
## 3 c          1.87
## 4 d          1.03
## 5 e         -0.94</code></pre>
<p>Altogether, the data look like this.</p>
<pre class="r"><code>theme_set(theme_grey() + 
            theme(panel.grid = element_blank()))

abc %&gt;%
  ggplot(aes(y = condition, x = response)) +
  geom_point(shape = 1)</code></pre>
<p><img src="/post/2018-12-20-make-rotated-gaussians-kruschke-style_files/figure-html/unnamed-chunk-4-1.png" width="576" /></p>
<p>Let’s get ready to model.</p>
</div>
<div id="just-one-intercept" class="section level2">
<h2>Just one intercept</h2>
<p>If you’ve read this far, you know we’re going Bayesian. Let’s open up our favorite Bayesian modeling package, Bürkner’s <a href="https://github.com/paul-buerkner/brms">brms</a>.</p>
<pre class="r"><code>library(brms)</code></pre>
<p>For our first model, we’ll ignore the groups and just estimate a grand mean and a standard deviation. Relative to the scale of the <code>abc</code> data, our priors are modestly <a href="https://github.com/stan-dev/stan/wiki/Prior-Choice-Recommendations">regularizing</a>.</p>
<pre class="r"><code>fit1 &lt;- 
  brm(data = abc,
      response ~ 1,
      prior = c(prior(normal(0, 1), class = Intercept),
                prior(student_t(3, 0, 1), class = sigma)))</code></pre>
<p>Extract the posterior draws and save them as a data frame we’ll call <code>post</code>.</p>
<pre class="r"><code>post &lt;- posterior_samples(fit1)

glimpse(post)</code></pre>
<pre><code>## Observations: 4,000
## Variables: 3
## $ b_Intercept &lt;dbl&gt; 0.5987480, 0.5987480, 0.7314609, 0.6445826, 0.5576...
## $ sigma       &lt;dbl&gt; 1.1177155, 1.1177155, 1.0092032, 1.0192299, 1.1700...
## $ lp__        &lt;dbl&gt; -76.96158, -76.96158, -77.46269, -77.09759, -77.26...</code></pre>
<p>If all you want is a quick and dirty way to plot a few of the model-implied Gaussians from the simple model, you can just nest <code>stat_function()</code> within <code>mapply()</code> and tack on the original data in a <code>geom_jitter()</code>.</p>
<pre class="r"><code># How many Gaussians would you like?
n_iter &lt;- 20

tibble(response = c(-4, 4)) %&gt;%
  ggplot(aes(x = response)) +
  mapply(function(mean, sd) {
    stat_function(fun   = dnorm, 
                  args  = list(mean = mean, sd = sd), 
                  alpha = 1/2, 
                  color = &quot;steelblue&quot;)
    }, 
    # Enter means and standard deviations here
    mean = post[1:n_iter, &quot;b_Intercept&quot;],
    sd   = post[1:n_iter, &quot;sigma&quot;]
    ) +
  geom_jitter(data = abc, aes(y = -0.02),
              height = .025, shape = 1, alpha = 2/3) +
  scale_y_continuous(NULL, breaks = NULL)</code></pre>
<p><img src="/post/2018-12-20-make-rotated-gaussians-kruschke-style_files/figure-html/unnamed-chunk-7-1.png" width="384" /></p>
<p>This works pretty okay. But notice the orientation is the usual horizontal. Kruschke’s Gaussians were on their sides. If we switch out our <code>scale_y_continuous()</code> line with <code>scale_y_reverse()</code> and add in <code>coord_flip()</code>, we’ll have it.</p>
<pre class="r"><code>tibble(response = c(-4, 4)) %&gt;%
  ggplot(aes(x = response)) +
  mapply(function(mean, sd) {
    stat_function(fun   = dnorm, 
                  args  = list(mean = mean, sd = sd), 
                  alpha = 1/2, 
                  color = &quot;steelblue&quot;)
    }, 
    mean = post[1:n_iter, &quot;b_Intercept&quot;],
    sd   = post[1:n_iter, &quot;sigma&quot;]
    ) +
  geom_jitter(data = abc, aes(y = -0.02),
              height = .025, shape = 1, alpha = 2/3) +
  scale_y_reverse(NULL, breaks = NULL) +
  coord_flip() </code></pre>
<p><img src="/post/2018-12-20-make-rotated-gaussians-kruschke-style_files/figure-html/unnamed-chunk-8-1.png" width="288" /></p>
<p>Boom. It won’t always be this easy, though.</p>
</div>
<div id="multiple-intercepts" class="section level2">
<h2>Multiple intercepts</h2>
<p>Since the <code>response</code> values are from a combination of five <code>condition</code> groups, we can fit a multilevel model to compute both the grand mean and the group-level deviations from the grand mean.</p>
<pre class="r"><code>fit2 &lt;- 
  brm(data = abc,
      response ~ 1 + (1 | condition),
      prior = c(prior(normal(0, 1), class = Intercept),
                prior(student_t(3, 0, 1), class = sigma),
                prior(student_t(3, 0, 1), class = sd)),
      cores = 4)</code></pre>
<p>“Wait. Whoa. I’m so confused”—you say. “What’s a multilevel model, again?” Read this <a href="https://xcelab.net/rm/statistical-rethinking/">book</a>, or this <a href="https://sites.google.com/site/doingbayesiandataanalysis/">book</a>; start <a href="https://www.youtube.com/watch?v=2sTQ7TG_85Q">here</a> on this lecture series; or even check out <a href="https://bookdown.org/connect/#/apps/1850/access">my project</a>, starting with chapter 12.</p>
<p>Once again, extract the posterior draws and save them as a data frame, <code>post</code>.</p>
<pre class="r"><code>post &lt;- posterior_samples(fit2)

str(post)</code></pre>
<pre><code>## &#39;data.frame&#39;:    4000 obs. of  9 variables:
##  $ b_Intercept             : num  0.575 -0.127 -0.212 0.737 1.099 ...
##  $ sd_condition__Intercept : num  0.996 1.181 1.27 1.108 0.797 ...
##  $ sigma                   : num  0.746 0.462 0.47 0.662 0.494 ...
##  $ r_condition[a,Intercept]: num  0.00792 0.09071 0.4438 -0.69639 -0.84514 ...
##  $ r_condition[b,Intercept]: num  0.242 1.174 1.118 0.187 -0.297 ...
##  $ r_condition[c,Intercept]: num  0.889 1.951 1.983 1.169 0.518 ...
##  $ r_condition[d,Intercept]: num  0.3866 1.1388 1.2904 0.0681 0.28 ...
##  $ r_condition[e,Intercept]: num  -0.979 -0.513 -1.037 -1.284 -2.105 ...
##  $ lp__                    : num  -57.8 -52.3 -51.8 -52.5 -56 ...</code></pre>
<p>This is where our task becomes difficult. Now each level of <code>condition</code> has its own mean estimate, which is a combination of the grand mean <code>b_Intercept</code> and the group-specific deviation, <code>r_condition[a,Intercept]</code> through <code>r_condition[e,Intercept]</code>. If all we wanted to do was show the model-implied Gaussians for, say, <code>condition == a</code>, that’d be a small extension of our last approach.</p>
<pre class="r"><code>tibble(response = c(-4, 4)) %&gt;%
  ggplot(aes(x = response)) +
  mapply(function(mean, sd) {
    stat_function(fun   = dnorm, 
                  args  = list(mean = mean, sd = sd), 
                  alpha = 1/2, 
                  color = &quot;steelblue&quot;)
    }, 
    # Here&#39;s the small extension, part a
    mean = post[1:n_iter, &quot;b_Intercept&quot;] + post[1:n_iter, &quot;r_condition[a,Intercept]&quot;],
    sd   = post[1:n_iter, &quot;sigma&quot;]
    ) +
  # The small extension, part b:
  geom_jitter(data = abc %&gt;% filter(condition == &quot;a&quot;), aes(y = 0),
              height = .025, shape = 1, alpha = 2/3) +
  scale_y_reverse(NULL, breaks = NULL) +
  coord_flip() +
  labs(subtitle = &quot;This is just for condition a&quot;)</code></pre>
<p><img src="/post/2018-12-20-make-rotated-gaussians-kruschke-style_files/figure-html/unnamed-chunk-10-1.png" width="288" /></p>
<p>The main thing we did was add to the definition of the <code>mean</code> within <code>mapply()</code>: <code>mean = post[1:n_iter, &quot;b_Intercept&quot;] + post[1:n_iter, &quot;r_condition[a,Intercept]&quot;]</code>. Within <code>geom_jitter()</code>, we also isolated the <code>condition == &quot;a&quot;</code> cases with <code>filter()</code>. Simple. However, it’s more of a pickle if we want multiple densities stacked atop/next to one another within the same plot.</p>
<p>Unfortunately, we can’t extend our <code>mapply(stat_function())</code> method to the group-level estimates–at least not that I’m aware. But there are other ways. We’ll need a little help from <code>tidybayes::spread_draws()</code>, about which you can learn more <a href="https://mjskay.github.io/tidybayes/articles/tidy-brms.html">here</a>.</p>
<pre class="r"><code>library(tidybayes)

sd &lt;-
  fit2 %&gt;% 
  spread_draws(b_Intercept, sigma, r_condition[condition,])
  
head(sd)</code></pre>
<pre><code>## # A tibble: 6 x 7
## # Groups:   condition [5]
##   .chain .iteration .draw b_Intercept sigma condition r_condition
##    &lt;int&gt;      &lt;int&gt; &lt;int&gt;       &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;           &lt;dbl&gt;
## 1      1          1     1       0.575 0.746 a             0.00792
## 2      1          1     1       0.575 0.746 b             0.242  
## 3      1          1     1       0.575 0.746 c             0.889  
## 4      1          1     1       0.575 0.746 d             0.387  
## 5      1          1     1       0.575 0.746 e            -0.979  
## 6      1          2     2      -0.127 0.462 a             0.0907</code></pre>
<p>In our <code>sp</code> <a href="https://cran.r-project.org/web/packages/tibble/vignettes/tibble.html">tibble</a>, we have much of the same information we’d get from <code>brms::posterior_samples()</code>, but in the long format with respect to the random effects for <code>condition</code>. Also notice that each row is indexed by the chain, iteration, and draw number. Among those, <code>.draw</code> is the column that corresponds to a unique row like what we’d get from <code>brms::posterior_samples()</code>. This is the index that ranges from 1 to the number of chains multiplied by the number of post-warmup iterations (i.e., default 4000 in our case).</p>
<p>But we need to wrangle a bit. Within the <code>expand()</code> function, we’ll select the columns we’d like to keep within the <code>nesting()</code> function and then expand the tibble by adding a sequence of <code>response</code> values ranging from -4 to 4, for each. This sets us up to use the <code>dnorm()</code> function in the next line to compute the density for each of those <code>response</code> values based on 20 unique normal distributions for each of the five <code>condition</code> groups. “Why 20?” Because we need some reasonably small number and 20’s the one Kruschke tended to use in his text and because, well, we set <code>filter(.draw &lt; 21)</code>. But choose whatever number you like.</p>
<p>The difficulty, however, is that all of these densities will have a minimum value of around 0 and all will be on the same basic scale. So we need a way to serially shift the density values up the y-axis in such a way that they’ll be sensibly separated by group. As far as I can figure, this’ll take us a couple steps. For the first step, we’ll create an intermediary variable, <code>g</code>, with which we’ll arbitrarily assign each of our five groups an integer index ranging from 0 to 4.</p>
<p>The second step is tricky. There we use our <code>g</code> integers to sequentially shift the density values up. Since our <code>g</code> value for <code>a == 0</code>, those we’ll keep 0 as their baseline. As our <code>g</code> value for <code>b == 1</code>, the baseline for those will now increase by 1. And so on for the other groups. But we still need to do a little more fiddling. What we want is for the maximum values of the density estimates to be a little lower than the baselines of the ones one grouping variable up. That is, we want the maximum values for the <code>a</code> densities to fall a little bit below 1 on the y-axis. It’s with the <code>* .75 / max(density)</code> part of the code that we accomplish that task. If you want to experiment with more or less room between the top and bottom of each density, play around with increasing/decreasing that .75 value.</p>
<pre class="r"><code>sd &lt;-
  sd %&gt;% 
  filter(.draw &lt; 21) %&gt;% 
  expand(nesting(.draw, b_Intercept, sigma, condition, r_condition), 
         response = seq(from = -4, to = 4, length.out = 200)) %&gt;%
  mutate(density = dnorm(response, mean = b_Intercept + r_condition, sd = sigma),
         g       = recode(condition,
                          a = 0,
                          b = 1,
                          c = 2,
                          d = 3,
                          e = 4)) %&gt;% 
  mutate(density = g + density * .75 / max(density))

glimpse(sd)</code></pre>
<pre><code>## Observations: 20,000
## Variables: 8
## $ .draw       &lt;int&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,...
## $ b_Intercept &lt;dbl&gt; 0.5752072, 0.5752072, 0.5752072, 0.5752072, 0.5752...
## $ sigma       &lt;dbl&gt; 0.7463794, 0.7463794, 0.7463794, 0.7463794, 0.7463...
## $ condition   &lt;chr&gt; &quot;a&quot;, &quot;a&quot;, &quot;a&quot;, &quot;a&quot;, &quot;a&quot;, &quot;a&quot;, &quot;a&quot;, &quot;a&quot;, &quot;a&quot;, &quot;a&quot;, ...
## $ r_condition &lt;dbl&gt; 0.007922818, 0.007922818, 0.007922818, 0.007922818...
## $ response    &lt;dbl&gt; -4.000000, -3.959799, -3.919598, -3.879397, -3.839...
## $ density     &lt;dbl&gt; 3.018427e-09, 4.195532e-09, 5.814782e-09, 8.035630...
## $ g           &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,...</code></pre>
<p>Since we’ll now be using the same axis for both the densities and the five <code>condition</code> groups, we’ll need to add a <code>density</code> column to our <code>abc</code> data.</p>
<pre class="r"><code>abc &lt;-
  abc %&gt;% 
  mutate(density = recode(condition,
                          a = 0,
                          b = 1,
                          c = 2,
                          d = 3,
                          e = 4))</code></pre>
<p>Time to plot.</p>
<pre class="r"><code>sd %&gt;% 
  ggplot(aes(x = response, y = density)) +
  # here we make our density lines
  geom_line(aes(group = interaction(.draw, g)),
            alpha = 1/2, size = 1/3, color = &quot;steelblue&quot;) +
  # use the original data for the jittered points
  geom_jitter(data = abc,
              height = .05, shape = 1, alpha = 2/3) +
  scale_y_continuous(&quot;condition&quot;,
                     breaks = 0:4,
                     labels = letters[1:5])</code></pre>
<p><img src="/post/2018-12-20-make-rotated-gaussians-kruschke-style_files/figure-html/unnamed-chunk-14-1.png" width="384" /></p>
<p>Now we’re rolling. Let’s make a cosmetic adjustment. Recall that the full range of the normal distribution spans from <span class="math inline">\(-\infty\)</span> to <span class="math inline">\(\infty\)</span>. At a certain point, it’s just not informative to show the left and right tails. If you look back up at our motivating example, you’ll note Kruschke’s densities stopped well before trailing off into the tails. If you look closely to the code from his text, you’ll see he’s just showing the inner 95-percentile range for each. To follow suit, we can compute those ranges with <code>qnorm()</code>.</p>
<pre class="r"><code>sd &lt;-
  sd %&gt;% 
  mutate(ll = qnorm(.025, mean = b_Intercept + r_condition, sd = sigma),
         ul = qnorm(.975, mean = b_Intercept + r_condition, sd = sigma))</code></pre>
<p>Now we have our lower- and upper-level points for each iteration, we can limit the ranges of our Gaussians with <code>filter()</code>.</p>
<pre class="r"><code>sd %&gt;% 
  filter(response &gt; ll,
         response &lt; ul) %&gt;% 
  
  ggplot(aes(x = response, y = density)) +
  geom_line(aes(group = interaction(.draw, g)),
            alpha = 1/2, size = 1/3, color = &quot;steelblue&quot;) +
  geom_jitter(data = abc,
              height = .05, shape = 1, alpha = 2/3) +
  scale_y_continuous(&quot;condition&quot;,
                     breaks = 0:4,
                     labels = letters[1:5])</code></pre>
<p><img src="/post/2018-12-20-make-rotated-gaussians-kruschke-style_files/figure-html/unnamed-chunk-16-1.png" width="384" /></p>
<p>Oh man, just look how sweet that is. Although I prefer our current method, another difference between it and Kruschke’s example is all of his densities are the same relative height. In all our plots so far, though, the densities differ by their heights. We’ll need a slight adjustment in our <code>sd</code> workflow for that. All we need to do is insert a <code>group_by()</code> statement between the two <code>mutate()</code> lines.</p>
<pre class="r"><code>sd &lt;-
  sd %&gt;% 
  mutate(density = dnorm(response, mean = b_Intercept + r_condition, sd = sigma),
         g       = recode(condition,
                          a = 0,
                          b = 1,
                          c = 2,
                          d = 3,
                          e = 4)) %&gt;% 
  # here&#39;s the new line
  group_by(.draw) %&gt;% 
  mutate(density = g + density * .75 / max(density))

# now plot
sd %&gt;% 
  filter(response &gt; ll,
         response &lt; ul) %&gt;% 
  ggplot(aes(x = response, y = density)) +
  geom_line(aes(group = interaction(.draw, g)),
            alpha = 1/2, size = 1/3, color = &quot;steelblue&quot;) +
  geom_jitter(data = abc,
              height = .05, shape = 1, alpha = 2/3) +
  scale_y_continuous(&quot;condition&quot;,
                     breaks = 0:4,
                     labels = letters[1:5])</code></pre>
<p><img src="/post/2018-12-20-make-rotated-gaussians-kruschke-style_files/figure-html/unnamed-chunk-17-1.png" width="384" /></p>
<p>Nice. “But wait!”, you say. “We wanted our Gaussians to be on their sides.” We can do that in at least two ways. At this point, the quickest way is to use our <code>scale_y_reverse() + coord_flip()</code> combo from before.</p>
<pre class="r"><code>sd %&gt;% 
  filter(response &gt; ll,
         response &lt; ul) %&gt;% 
  
  ggplot(aes(x = response, y = density)) +
  geom_line(aes(group = interaction(.draw, g)),
            alpha = 1/2, size = 1/3, color = &quot;steelblue&quot;) +
  geom_jitter(data = abc,
              height = .05, shape = 1, alpha = 2/3) +
  scale_y_reverse(&quot;condition&quot;,
                  breaks = 0:4,
                  labels = letters[1:5]) +
  coord_flip()</code></pre>
<p><img src="/post/2018-12-20-make-rotated-gaussians-kruschke-style_files/figure-html/unnamed-chunk-18-1.png" width="384" /></p>
<p>Another way to get those sideways Gaussians is to alter our <code>sd</code> data workflow. The main differene is this time we change the original <code>mutate(density = g + density * .75 / max(density))</code> line to <code>mutate(density = g - density * .75 / max(density))</code>. In case you missed it, the only difference is we changed the <code>+</code> to a <code>-</code>.</p>
<pre class="r"><code>sd &lt;-
  sd %&gt;% 
  # step one: starting fresh
  mutate(density = dnorm(response, mean = b_Intercept + r_condition, sd = sigma)) %&gt;% 
  group_by(.draw) %&gt;% 
  # step two: now SUBTRACTING density from g within the equation
  mutate(density = g - density * .75 / max(density))</code></pre>
<p>Now in our global <code>aes()</code> statement in the plot, we put <code>density</code> on the x and <code>response</code> on the y. We need to take a few other subtle steps:</p>
<ul>
<li>Switch out <code>geom_line()</code> for <code>geom_path()</code> (see <a href="https://ggplot2.tidyverse.org/reference/geom_path.html">here</a>).</li>
<li>Drop the <code>height</code> argument within <code>geom_jitter()</code> for <code>width</code>.</li>
<li>Switch out <code>scale_y_continuous()</code> for <code>scale_x_continuous()</code>.</li>
</ul>
<p>Though totally not necessary, we’ll add a little something extra by coloring the Gaussians by their means.</p>
<pre class="r"><code>sd %&gt;% 
  filter(response &gt; ll,
         response &lt; ul) %&gt;% 
  
  ggplot(aes(x = density, y = response)) +
  geom_path(aes(group = interaction(.draw, g), 
                color = b_Intercept + r_condition),
            alpha = 1/2, size = 1/3, show.legend = F) +
  geom_jitter(data = abc,
              width = .05, shape = 1, alpha = 2/3) +
  scale_x_continuous(&quot;condition&quot;,
                     breaks = 0:4,
                     labels = letters[1:5]) +
  scale_color_viridis_c(option = &quot;A&quot;, end = .92)</code></pre>
<p><img src="/post/2018-12-20-make-rotated-gaussians-kruschke-style_files/figure-html/unnamed-chunk-20-1.png" width="384" /></p>
<p>There you have it–Kruschke-style sideways Gaussians for your model plots.</p>
</div>
<div id="session-info" class="section level2">
<h2>Session info</h2>
<pre class="r"><code>sessionInfo()</code></pre>
<pre><code>## R version 3.5.1 (2018-07-02)
## Platform: x86_64-apple-darwin15.6.0 (64-bit)
## Running under: macOS High Sierra 10.13.6
## 
## Matrix products: default
## BLAS: /Library/Frameworks/R.framework/Versions/3.5/Resources/lib/libRblas.0.dylib
## LAPACK: /Library/Frameworks/R.framework/Versions/3.5/Resources/lib/libRlapack.dylib
## 
## locale:
## [1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8
## 
## attached base packages:
## [1] stats     graphics  grDevices utils     datasets  methods   base     
## 
## other attached packages:
##  [1] tidybayes_1.0.3 brms_2.7.0      Rcpp_1.0.0      bindrcpp_0.2.2 
##  [5] forcats_0.3.0   stringr_1.3.1   dplyr_0.7.6     purrr_0.2.5    
##  [9] readr_1.1.1     tidyr_0.8.1     tibble_1.4.2    ggplot2_3.1.0  
## [13] tidyverse_1.2.1
## 
## loaded via a namespace (and not attached):
##   [1] colorspace_1.3-2          ggridges_0.5.0           
##   [3] rsconnect_0.8.8           rprojroot_1.3-2          
##   [5] ggstance_0.3              markdown_0.8             
##   [7] base64enc_0.1-3           rstudioapi_0.7           
##   [9] rstan_2.18.2              svUnit_0.7-12            
##  [11] DT_0.4                    mvtnorm_1.0-8            
##  [13] lubridate_1.7.4           xml2_1.2.0               
##  [15] bridgesampling_0.4-0      mnormt_1.5-5             
##  [17] knitr_1.20                shinythemes_1.1.1        
##  [19] bayesplot_1.6.0           jsonlite_1.5             
##  [21] broom_0.4.5               shiny_1.1.0              
##  [23] compiler_3.5.1            httr_1.3.1               
##  [25] backports_1.1.2           assertthat_0.2.0         
##  [27] Matrix_1.2-14             lazyeval_0.2.1           
##  [29] cli_1.0.1                 later_0.7.3              
##  [31] htmltools_0.3.6           prettyunits_1.0.2        
##  [33] tools_3.5.1               igraph_1.2.1             
##  [35] coda_0.19-2               gtable_0.2.0             
##  [37] glue_1.3.0                reshape2_1.4.3           
##  [39] cellranger_1.1.0          nlme_3.1-137             
##  [41] blogdown_0.8              crosstalk_1.0.0          
##  [43] psych_1.8.4               xfun_0.3                 
##  [45] ps_1.2.1                  rvest_0.3.2              
##  [47] mime_0.5                  miniUI_0.1.1.1           
##  [49] gtools_3.8.1              MASS_7.3-50              
##  [51] zoo_1.8-2                 scales_1.0.0             
##  [53] colourpicker_1.0          hms_0.4.2                
##  [55] promises_1.0.1            Brobdingnag_1.2-5        
##  [57] parallel_3.5.1            inline_0.3.15            
##  [59] shinystan_2.5.0           yaml_2.1.19              
##  [61] gridExtra_2.3             loo_2.0.0                
##  [63] StanHeaders_2.18.0-1      stringi_1.2.3            
##  [65] dygraphs_1.1.1.5          pkgbuild_1.0.2           
##  [67] rlang_0.3.0.1             pkgconfig_2.0.1          
##  [69] matrixStats_0.54.0        evaluate_0.10.1          
##  [71] lattice_0.20-35           bindr_0.1.1              
##  [73] rstantools_1.5.0          htmlwidgets_1.2          
##  [75] labeling_0.3              tidyselect_0.2.4         
##  [77] processx_3.2.1            plyr_1.8.4               
##  [79] magrittr_1.5              bookdown_0.7             
##  [81] R6_2.3.0                  pillar_1.2.3             
##  [83] haven_1.1.2               foreign_0.8-70           
##  [85] withr_2.1.2               xts_0.10-2               
##  [87] abind_1.4-5               modelr_0.1.2             
##  [89] crayon_1.3.4              arrayhelpers_1.0-20160527
##  [91] utf8_1.1.4                rmarkdown_1.10           
##  [93] grid_3.5.1                readxl_1.1.0             
##  [95] callr_3.1.0               threejs_0.3.1            
##  [97] digest_0.6.18             xtable_1.8-2             
##  [99] httpuv_1.4.4.2            stats4_3.5.1             
## [101] munsell_0.5.0             viridisLite_0.3.0        
## [103] shinyjs_1.0</code></pre>
</div>

    </div>

    


<div class="article-tags">
  
  <a class="badge badge-light" href="/tags/bayesian/">Bayesian</a>
  
  <a class="badge badge-light" href="/tags/brms/">brms</a>
  
  <a class="badge badge-light" href="/tags/kruschke/">Kruschke</a>
  
  <a class="badge badge-light" href="/tags/plot/">plot</a>
  
  <a class="badge badge-light" href="/tags/r/">R</a>
  
  <a class="badge badge-light" href="/tags/tutorial/">tutorial</a>
  
  <a class="badge badge-light" href="/tags/tydiverse/">tydiverse</a>
  
</div>




    
    
    <div class="article-widget">
      <div class="hr-light"></div>
      <h3>Related</h3>
      <ul>
        
        <li><a href="/post/bayesian-meta-analysis/">Bayesian meta-analysis in brms</a></li>
        
        <li><a href="/post/how-bookdown/">bookdown, My Process</a></li>
        
      </ul>
    </div>
    

    

    


  </div>
</article>

<div class="container">
  <footer class="site-footer">
  

  <p class="powered-by">
    &copy; 2018 &middot; 

    Powered by the
    <a href="https://sourcethemes.com/academic/" target="_blank" rel="noopener">Academic theme</a> for
    <a href="https://gohugo.io" target="_blank" rel="noopener">Hugo</a>.

    
    <span class="float-right" aria-hidden="true">
      <a href="#" id="back_to_top">
        <span class="button_icon">
          <i class="fas fa-chevron-up fa-2x"></i>
        </span>
      </a>
    </span>
    
  </p>
</footer>

</div>


<div id="modal" class="modal fade" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Cite</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <pre><code class="tex hljs"></code></pre>
      </div>
      <div class="modal-footer">
        <a class="btn btn-outline-primary my-1 js-copy-cite" href="#" target="_blank">
          <i class="fas fa-copy"></i> Copy
        </a>
        <a class="btn btn-outline-primary my-1 js-download-cite" href="#" target="_blank">
          <i class="fas fa-download"></i> Download
        </a>
        <div id="modal-error"></div>
      </div>
    </div>
  </div>
</div>

    

    
    
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        CommonHTML: { linebreaks: { automatic: true } },
        tex2jax: { inlineMath: [ ['$', '$'], ['\\(','\\)'] ], displayMath: [ ['$$','$$'], ['\\[', '\\]'] ], processEscapes: false },
        TeX: { noUndefined: { attributes: { mathcolor: 'red', mathbackground: '#FFEEEE', mathsize: '90%' } } },
        messageStyle: 'none'
      });
    </script>
    

    
    
    
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha512-+NqPlbbtM1QqiK8ZAo4Yrj2c4lNQoGv8P79DPtKzj++l5jnN39rHA/xsqn8zE9l0uSoxaCdrOgFs6yjyfbBxSg==" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/4.1.3/imagesloaded.pkgd.min.js" integrity="sha512-umsR78NN0D23AzgoZ11K7raBD+R6hqKojyBZs1w8WvYlsI+QuKRGBx3LFCwhatzBunCjDuJpDHwxD13sLMbpRA==" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha256-VsEqElsCHSGmnmHXGQzvoWjWwoznFSZc6hs7ARLRacQ=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.isotope/3.0.4/isotope.pkgd.min.js" integrity="sha512-VDBOIlDbuC4VWxGJNmuFRQ0Li0SKkDpmGyuhAG5LTDLd/dJ/S0WMVxriR2Y+CyPL5gzjpN4f/6iqWVBJlht0tQ==" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.2.5/jquery.fancybox.min.js" integrity="sha256-X5PoE3KU5l+JcX+w09p/wHl9AzK333C4hJ2I9S5mD4M=" crossorigin="anonymous"></script>

      
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js" integrity="sha256-/BfiIkHlHoVihZdc6TFuj7MmJ0TWcWsMXkeDFwhi0zw=" crossorigin="anonymous"></script>
        
      

      
      
      <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=TeX-AMS_CHTML-full" integrity="sha256-GhM+5JHb6QUzOQPXSJLEWP7R73CbkisjzK5Eyij4U9w=" crossorigin="anonymous" async></script>
      
    

    <script src="/js/hugo-academic.js"></script>
    

    
    

    
    
    

    
    
    <script>hljs.initHighlightingOnLoad();</script>
    

    
    
    <script>
      const search_index_filename = "/index.json";
      const i18n = {
        'placeholder': "Search...",
        'results': "Search Results",
        'no_results': "No results found"
      };
      const content_type = {
        'post': "Posts",
        'project': "Projects",
        'publication' : "Publications",
        'talk' : "Talks"
        };
    </script>
    

    
    

    
    
    <script id="search-hit-fuse-template" type="text/x-template">
      <div class="search-hit" id="summary-{{key}}">
      <div class="search-hit-content">
        <div class="search-hit-name">
          <a href="{{relpermalink}}">{{title}}</a>
          <div class="article-metadata search-hit-type">{{type}}</div>
          <p class="search-hit-description">{{snippet}}</p>
        </div>
      </div>
      </div>
    </script>
    

    
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/3.2.1/fuse.min.js" integrity="sha256-VzgmKYmhsGNNN4Ph1kMW+BjoYJM2jV5i4IlFoeZA9XI=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script>
    <script src="/js/search.js"></script>
    

    
    

  </body>
</html>

