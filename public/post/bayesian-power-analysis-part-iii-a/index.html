<!DOCTYPE html>
<html lang="en-us">
<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="generator" content="Source Themes Academic 2.4.0">
  <meta name="generator" content="Hugo 0.49" />
  <meta name="author" content="A. Solomon Kurz">

  
  
  
  
    
  
  <meta name="description" content="Version 1.0.0  tl;dr So far we’ve covered Bayesian power simulations from both a null hypothesis orientation (see part I) and a parameter width perspective (see part II). In both instances, we kept things simple and stayed with Gaussian (i.e., normally distributed) data. But not all data follow that form, so it might do us well to expand our skill set a bit. In the next few posts, we’ll cover how we might perform power simulations with other kinds of data.">

  
  <link rel="alternate" hreflang="en-us" href="/post/bayesian-power-analysis-part-iii-a/">

  


  

  

  

  
  
  
  <meta name="theme-color" content="#0095eb">
  

  
  
  
  
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha256-eSi1q2PG6J7g7ib17yAaWMcrr5GrtohYChqibrV7PBE=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/academicons/1.8.6/css/academicons.min.css" integrity="sha256-uFVgMKfistnJAfoCUQigIl+JfUaP47GrRKjf6CTPVmw=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.3.1/css/all.css" integrity="sha384-mzrmE5qonljUremFsqc01SB46JvROS7bZs3IO2EmfFsd15uHvIt+Y8vEf7N7fWAU" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.2.5/jquery.fancybox.min.css" integrity="sha256-ygkqlh3CYSUri3LhQxzdcm0n1EQvH2Y+U5S2idbLtxs=" crossorigin="anonymous">

    
    
    
      
    
    
      
      
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css" crossorigin="anonymous">
      
    

    

    

  

  
  
  <link rel="stylesheet" href=//fonts.googleapis.com/css?family=Montserrat:400,700|Roboto:400,400italic,700|Roboto+Mono>
  

  <link rel="stylesheet" href="/styles.css">
  

  
  
  

  
  <link rel="alternate" href="/index.xml" type="application/rss+xml" title="A. Solomon Kurz">
  <link rel="feed" href="/index.xml" type="application/rss+xml" title="A. Solomon Kurz">
  

  <link rel="manifest" href="/site.webmanifest">
  <link rel="icon" type="image/png" href="/img/icon.png">
  <link rel="apple-touch-icon" type="image/png" href="/img/icon-192.png">

  <link rel="canonical" href="/post/bayesian-power-analysis-part-iii-a/">

  <meta property="twitter:card" content="summary_large_image">
  
  <meta property="twitter:site" content="@SolomonKurz">
  <meta property="twitter:creator" content="@SolomonKurz">
  
  <meta property="og:site_name" content="A. Solomon Kurz">
  <meta property="og:url" content="/post/bayesian-power-analysis-part-iii-a/">
  <meta property="og:title" content="Bayesian power analysis: Part III.a. Counts are special. | A. Solomon Kurz">
  <meta property="og:description" content="Version 1.0.0  tl;dr So far we’ve covered Bayesian power simulations from both a null hypothesis orientation (see part I) and a parameter width perspective (see part II). In both instances, we kept things simple and stayed with Gaussian (i.e., normally distributed) data. But not all data follow that form, so it might do us well to expand our skill set a bit. In the next few posts, we’ll cover how we might perform power simulations with other kinds of data.">
  
  
    
  <meta property="og:image" content="/img/Solomon%20at%20Double%20Decker.jpg">
  <meta property="og:locale" content="en-us">
  
  <meta property="article:published_time" content="2019-08-11T00:00:00&#43;00:00">
  
  <meta property="article:modified_time" content="2019-08-11T00:00:00&#43;00:00">
  

  

  

  <title>Bayesian power analysis: Part III.a. Counts are special. | A. Solomon Kurz</title>

</head>
<body id="top" data-spy="scroll" data-target="#TableOfContents" data-offset="71" >

<nav class="navbar navbar-light fixed-top navbar-expand-lg py-0" id="navbar-main">
  <div class="container">

    
      <a class="navbar-brand" href="/">A. Solomon Kurz</a>
      
      <button type="button" class="navbar-toggler" data-toggle="collapse"
              data-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
        <span><i class="fas fa-bars"></i></span>
      </button>
      

    
    <div class="collapse navbar-collapse" id="navbar">

      
      
      <ul class="navbar-nav ml-auto">
        

        

        
        
        
          
        

        <li class="nav-item">
          <a class="nav-link" href="/#about">
            
            <span>Home</span>
            
          </a>
        </li>

        
        

        

        
        
        
          
        

        <li class="nav-item">
          <a class="nav-link" href="/post/">
            
            <span>Blog posts</span>
            
          </a>
        </li>

        
        

        

        
        
        
          
        

        <li class="nav-item">
          <a class="nav-link" href="/bookdown/">
            
            <span>Book-length projects</span>
            
          </a>
        </li>

        
        

        

        
        
        
          
        

        <li class="nav-item">
          <a class="nav-link" href="/teaching/">
            
            <span>Teaching</span>
            
          </a>
        </li>

        
        

        

        
        
        
          
        

        <li class="nav-item">
          <a class="nav-link" href="/conflicts_of_interest/">
            
            <span>Conflicts of interest</span>
            
          </a>
        </li>

        
        

      

        

        
      </ul>

    </div>
  </div>
</nav>


<article class="article" itemscope itemtype="http://schema.org/Article">

  





  <div class="article-container">
    <h1 itemprop="name">Bayesian power analysis: Part III.a. Counts are special.</h1>

    

<div class="article-metadata">

  
  
  <span itemscope itemprop="author" itemtype="http://schema.org/Person">
    <meta itemprop="name" content="A. Solomon Kurz">
  </span>
  

  <span class="article-date">
    
    <meta content="2019-08-11 00:00:00 &#43;0000 UTC" itemprop="datePublished">
    <time datetime="2019-08-11 00:00:00 &#43;0000 UTC" itemprop="dateModified">
      Aug 11, 2019
    </time>
  </span>
  <span itemscope itemprop="publisher" itemtype="http://schema.org/Person">
    <meta itemprop="name" content="A. Solomon Kurz">
  </span>

  
  <span class="middot-divider"></span>
  <span class="article-reading-time">
    14 min read
  </span>
  

  
  

  
  
  
  

  
  
<div class="share-box" aria-hidden="true">
  <ul class="share">
    <li>
      <a class="twitter"
         href="https://twitter.com/intent/tweet?text=Bayesian%20power%20analysis%3a%20Part%20III.a.%20Counts%20are%20special.&amp;url=%2fpost%2fbayesian-power-analysis-part-iii-a%2f"
         target="_blank" rel="noopener">
        <i class="fab fa-twitter"></i>
      </a>
    </li>
    <li>
      <a class="facebook"
         href="https://www.facebook.com/sharer.php?u=%2fpost%2fbayesian-power-analysis-part-iii-a%2f"
         target="_blank" rel="noopener">
        <i class="fab fa-facebook-f"></i>
      </a>
    </li>
    <li>
      <a class="linkedin"
         href="https://www.linkedin.com/shareArticle?mini=true&amp;url=%2fpost%2fbayesian-power-analysis-part-iii-a%2f&amp;title=Bayesian%20power%20analysis%3a%20Part%20III.a.%20Counts%20are%20special."
         target="_blank" rel="noopener">
        <i class="fab fa-linkedin-in"></i>
      </a>
    </li>
    <li>
      <a class="weibo"
         href="http://service.weibo.com/share/share.php?url=%2fpost%2fbayesian-power-analysis-part-iii-a%2f&amp;title=Bayesian%20power%20analysis%3a%20Part%20III.a.%20Counts%20are%20special."
         target="_blank" rel="noopener">
        <i class="fab fa-weibo"></i>
      </a>
    </li>
    <li>
      <a class="email"
         href="mailto:?subject=Bayesian%20power%20analysis%3a%20Part%20III.a.%20Counts%20are%20special.&amp;body=%2fpost%2fbayesian-power-analysis-part-iii-a%2f">
        <i class="fas fa-envelope"></i>
      </a>
    </li>
  </ul>
</div>


  

</div>


    <div class="article-style" itemprop="articleBody">
      <div id="version-1.0.0" class="section level2">
<h2>Version 1.0.0</h2>
</div>
<div id="tldr" class="section level2">
<h2>tl;dr</h2>
<p>So far we’ve covered Bayesian power simulations from both a null hypothesis orientation (see <a href="https://solomonkurz.netlify.com/post/bayesian-power-analysis-part-i/">part I</a>) and a parameter width perspective (see <a href="https://solomonkurz.netlify.com/post/bayesian-power-analysis-part-ii/">part II</a>). In both instances, we kept things simple and stayed with Gaussian (i.e., normally distributed) data. But not all data follow that form, so it might do us well to expand our skill set a bit. In the next few posts, we’ll cover how we might perform power simulations with other kinds of data. In this post, we’ll focus on how to use the Poisson likelihood to model counts. In follow-up posts, we’ll explore how to model binary and Likert-type data.</p>
</div>
<div id="the-poisson-distribution-is-handy-for-counts." class="section level2">
<h2>The Poisson distribution is handy for counts.</h2>
<p>In the social sciences, count data arise when we ask questions like:</p>
<ul>
<li>How many sexual partners have you had?</li>
<li>How many pets do you have at home?</li>
<li>How many cigarettes did you smoke, yesterday?</li>
</ul>
<p>The values these data will take are discrete <a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a> in that you’ve either slept with 9 or 10 people, but definitely not 9.5. The values cannot go below zero in that even if you quit smoking cold turkey 15 years ago and have been a health nut since, you still could not have smoked -3 cigarettes, yesterday. Zero is as low as it goes.</p>
<p>The canonical distribution for data of this type–non-zero integers–is the Poisson. It’s named after the French mathematician Siméon Denis Poisson, <a href="https://upload.wikimedia.org/wikipedia/commons/e/e8/E._Marcellot_Siméon-Denis_Poisson_1804.jpg">who had quite the confident stare in his youth</a>. The Poisson distribution has one parameter, <span class="math inline">\(\lambda\)</span>, which controls both its mean and variance. Although the numbers the Poisson describes are counts, the <span class="math inline">\(\lambda\)</span> parameter does not need to be an integer. For example, here’s the plot of 1000 draws from a Poisson for which <span class="math inline">\(\lambda = 3.2\)</span>.</p>
<pre class="r"><code>library(tidyverse)

theme_set(theme_gray() + theme(panel.grid = element_blank()))

tibble(x = rpois(n = 1e3, lambda = 3.2)) %&gt;% 
  mutate(x = factor(x)) %&gt;% 
  
  ggplot(aes(x = x)) +
  geom_bar()</code></pre>
<p><img src="/post/2019-08-11-bayesian-power-analysis-part-iii-a_files/figure-html/unnamed-chunk-1-1.png" width="384" /></p>
<p>In case you missed it, the key function for generating those data was <code>rpois()</code>. I’m not going to go into a full-blown tutorial on the Poisson distribution or on count regression. For more thorough introductions, check out Atkins et al’s <a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC3513584/pdf/nihms396181.pdf"><em>A tutorial on count regression and zero-altered count models for longitudinal substance use data</em></a>, chapters 9 through 11 in McElreath’s <a href="https://xcelab.net/rm/statistical-rethinking/"><em>Statistical Rethinking</em></a>, or, if you really want to dive in, Agresti’s <a href="https://www.wiley.com/en-us/Foundations+of+Linear+and+Generalized+Linear+Models-p-9781118730034"><em>Foundations of Linear and Generalized Linear Models</em></a>.</p>
<p>For our power example, let’s say you were interested in drinking. Using data from <a href="https://pubs.niaaa.nih.gov/publications/AA70/AA70.htm">the National Epidemiologic Survey on Alcohol and Related Conditions</a>, Christopher Ingraham presented <a href="https://www.washingtonpost.com/news/wonk/wp/2014/09/25/think-you-drink-a-lot-this-chart-will-tell-you/?utm_term=.b81599bbbe25">a data visualization</a> of the average number of alcoholic drinks American adults consume, per week. By decile, the numbers were:</p>
<ol style="list-style-type: decimal">
<li>0.00</li>
<li>0.00</li>
<li>0.00</li>
<li>0.02</li>
<li>0.14</li>
<li>0.63</li>
<li>2.17</li>
<li>6.25</li>
<li>15.28</li>
<li>73.85</li>
</ol>
<p>Let’s say you wanted to run a study where you planned on comparing two demographic groups by their weekly drinking levels. Let’s further say you suspected one of those groups drank like the American adults in the 7<sup>th</sup> decile and the other drank like American adults in the 8<sup>th</sup>. We’ll call them low and high drinkers, respectively. For convenience, let’s further presume you’ll be able to recruit equal numbers of participants from both groups. The objective for our power analysis–or sample size analysis if you prefer to avoid the language of <em>power</em>–is to determine how many you’d need per group to detect reliable differences. Using <span class="math inline">\(n = 50\)</span> as a starting point, here’s what the data for our hypothetical groups might look like.</p>
<pre class="r"><code>mu_7 &lt;- 2.17
mu_8 &lt;- 6.25

n &lt;- 50

set.seed(3)

d &lt;-
  tibble(low  = rpois(n = n, lambda = mu_7),
         high = rpois(n = n, lambda = mu_8)) %&gt;% 
  gather(group, count) 

d %&gt;%
  mutate(count = factor(count)) %&gt;% 
  
  ggplot(aes(x = count)) +
  geom_bar() +
  facet_wrap(~group, ncol = 1)</code></pre>
<p><img src="/post/2019-08-11-bayesian-power-analysis-part-iii-a_files/figure-html/unnamed-chunk-2-1.png" width="384" /></p>
<p>This will be our primary data type. Our next step is to determine how to express our research question as a regression model. Like with our two-group Gaussian models, we can predict counts in terms of an intercept (i.e., standing for the expected value on the reference group) and slope (i.e., standing for the expected difference between the reference group and the comparison group). If we coded our two groups by a <code>high</code> variable for which 0 stood for low drinkers and 1 stood for high drinkers, the basic model would follow the form</p>
<p><span class="math display">\[
\begin{align*}
\text{drinks_per_week}_i         &amp; \sim \text{Poisson}(\lambda_i) \\
\operatorname{log} (\lambda_i)   &amp; = \beta_0 + \beta_1 \text{high}_i.
\end{align*}
\]</span></p>
<p>Here’s how to set the data up for that model.</p>
<pre class="r"><code>d &lt;-
  d %&gt;% 
  mutate(high = ifelse(group == &quot;low&quot;, 0, 1))</code></pre>
<p>If you were attending closely to our model formula, you noticed we ran into a detail. Count regression, such as with the Poisson likelihood, tends to use the log link. <em>Why?</em> you ask. Recall that counts need to be 0 and above. Same deal for our <span class="math inline">\(\lambda\)</span> parameter. In order to make sure our models don’t yield silly estimates for <span class="math inline">\(\lambda\)</span>, like -2 or something, we typically use the log link. You don’t have to, of course. The world is your playground. But this is the method most of your colleagues are likely to use and it’s the one I suggest you use until you have compelling reasons to do otherwise.</p>
<p>So then since we’re now fitting a model with a log link, it might seem challenging to pick good priors. As a place to start, we can use the <code>brms::get_prior()</code> function to see the <strong>brms</strong> defaults.</p>
<pre class="r"><code>library(brms)

get_prior(data = d,
          family = poisson,
          count ~ 0 + intercept + high)</code></pre>
<pre><code>##   prior class      coef group resp dpar nlpar bound
## 1           b                                      
## 2           b      high                            
## 3           b intercept</code></pre>
<p>Hopefully two things popped out. First, there’s no prior of <code>class = sigma</code>. Since the Poisson distribution only has one parameter <span class="math inline">\(\lambda\)</span>, we don’t need to set a prior for <span class="math inline">\(\sigma\)</span>. Our model won’t have one. Second, because we’re continuing to use the <code>0 + intercept</code> syntax for our model intercept, both our intercept and slope are of prior <code>class = b</code> and those currently have default flat priors with <strong>brms</strong>. To be sure, flat priors aren’t the best. But maybe if this was your first time playing around with a Poisson model, default flat priors might seem like a safe place to start. <a href="https://xkcd.com/386/">Feel free to disagree</a>. In the meantime, here’s how to fit that default Poisson model with <code>brms::brm()</code>.</p>
<pre class="r"><code>fit1 &lt;-
  brm(data = d,
      family = poisson,
      count ~ 0 + intercept + high,
      seed = 3)</code></pre>
<pre class="r"><code>print(fit1)</code></pre>
<pre><code>##  Family: poisson 
##   Links: mu = log 
## Formula: count ~ 0 + intercept + high 
##    Data: d (Number of observations: 100) 
## Samples: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
##          total post-warmup samples = 4000
## 
## Population-Level Effects: 
##           Estimate Est.Error l-95% CI u-95% CI Eff.Sample Rhat
## intercept     0.59      0.11     0.37     0.81        984 1.00
## high          1.27      0.12     1.02     1.50       1003 1.00
## 
## Samples were drawn using sampling(NUTS). For each parameter, Eff.Sample 
## is a crude measure of effective sample size, and Rhat is the potential 
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<p>Since we used the log link, our model results are in the log metric, too. If you’d like them in the metric of the data, you’d work directly with the poster samples and exponentiate.</p>
<pre class="r"><code>post &lt;- 
  posterior_samples(fit1) %&gt;% 
  mutate(`beta_0 (i.e., low)`                       = exp(b_intercept),
         `beta_1 (i.e., difference score for high)` = exp(b_high))</code></pre>
<p>We can then just summarize our parameters of interest.</p>
<pre class="r"><code>post %&gt;% 
  select(starts_with(&quot;beta_&quot;)) %&gt;% 
  gather() %&gt;% 
  group_by(key) %&gt;% 
  summarise(mean  = mean(value),
            lower = quantile(value, prob = .025),
            upper = quantile(value, prob = .975))</code></pre>
<pre><code>## # A tibble: 2 x 4
##   key                                       mean lower upper
##   &lt;chr&gt;                                    &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1 beta_0 (i.e., low)                        1.81  1.45  2.24
## 2 beta_1 (i.e., difference score for high)  3.58  2.78  4.50</code></pre>
<p>For the sake of simulation, it’ll be easier if we press on with evaluating the parameters on the log metric, though. If you’re working within a null-hypothesis oriented power paradigm, you’ll be happy to know zero is still the number to beat for evaluating our 95% intervals for <span class="math inline">\(\beta_1\)</span>, even when that parameter is in the log metric. Here it is, again.</p>
<pre class="r"><code>library(broom)

tidy(fit1, prob = .95) %&gt;% 
  filter(term == &quot;b_high&quot;)</code></pre>
<pre><code>##     term estimate std.error   lower    upper
## 1 b_high 1.266527 0.1232635 1.02143 1.504801</code></pre>
<p>So our first fit suggests we’re on good footing to run a quick power simulation holding <span class="math inline">\(n = 50\)</span>. As in the prior blog posts, our lives will be simpler if we set up a custom simulation function. Since we’ll be using it to simulate the data and fit the model in one step, let’s call it <code>sim_data_fit()</code>.</p>
<pre class="r"><code>sim_data_fit &lt;- function(seed, n) {
  
  # define our mus in the function
  mu_7 &lt;- 2.17
  mu_8 &lt;- 6.25

  # make your results reproducible
  set.seed(seed)
  
  # simulate the data
  d &lt;-
    tibble(high  = rep(0:1, each = n),
           count = c(rpois(n = n, lambda = mu_7),
                     rpois(n = n, lambda = mu_8)))
  
  # fit and summarise
  update(fit1,
         newdata = d,
         seed = seed) %&gt;% 
  tidy(prob = .95) %&gt;% 
  filter(term == &quot;b_high&quot;) %&gt;% 
  select(lower:upper)
  
}</code></pre>
<p>Here’s the simulation for a simple 100 iterations.</p>
<pre class="r"><code>sim1 &lt;-
  tibble(seed = 1:100) %&gt;% 
  mutate(ci = map(seed, sim_data_fit, n = 50)) %&gt;% 
  unnest()</code></pre>
<p>That went quick–less than 3 minutes on my old laptop. Here’s what those 100 <span class="math inline">\(\beta_1\)</span> intervals look like in bulk.</p>
<pre class="r"><code>sim1 %&gt;% 
  
  ggplot(aes(x = seed, ymin = lower, ymax = upper)) +
  geom_hline(yintercept = 0, color = &quot;white&quot;) +
  geom_linerange() +
  labs(x = &quot;seed (i.e., simulation index)&quot;,
       y = expression(beta[1]))</code></pre>
<p><img src="/post/2019-08-11-bayesian-power-analysis-part-iii-a_files/figure-html/unnamed-chunk-10-1.png" width="768" /></p>
<p>None of them are anywhere near the null value 0. So it appears we’re well above .8 power to reject the typical <span class="math inline">\(H_0\)</span> with <span class="math inline">\(n = 50\)</span>. Switching to the precision orientation, here’s the distribution of their widths.</p>
<pre class="r"><code>sim1 %&gt;% 
  mutate(width = upper - lower) %&gt;% 
  
  ggplot(aes(x = width)) +
  geom_histogram(binwidth = 0.01)</code></pre>
<p><img src="/post/2019-08-11-bayesian-power-analysis-part-iii-a_files/figure-html/unnamed-chunk-11-1.png" width="384" /></p>
<p>What if we wanted a mean width of 0.25 on the log scale? We might try the simulation with <span class="math inline">\(n = 150\)</span>.</p>
<pre class="r"><code>sim2 &lt;-
  tibble(seed = 1:100) %&gt;% 
  mutate(ci = map(seed, sim_data_fit, n = 150)) %&gt;% 
  unnest()</code></pre>
<p>Here we’ll summarize the widths both in terms of their mean and what proportion were smaller than 0.25.</p>
<pre class="r"><code>sim2 %&gt;% 
  mutate(width = upper - lower) %&gt;% 
  summarise(`mean width` = mean(width),
            `below 0.25` = mean(width &lt; 0.25))</code></pre>
<pre><code>## # A tibble: 1 x 2
##   `mean width` `below 0.25`
##          &lt;dbl&gt;        &lt;dbl&gt;
## 1        0.253          0.4</code></pre>
<p>If we wanted to focus on the mean, we did pretty good. Perhaps set the <span class="math inline">\(n = 155\)</span> and simulate a full 1000+ iterations for a serious power analysis. But if we wanted to make the stricter criteria of all below 0.25, we’d need to up the <span class="math inline">\(n\)</span> quite a bit more. And of course, once you have a little experience working with Poisson models, you might do the power simulations with more ambitious priors. For example, if your count values are lower than like 1000, there’s a good chance a <code>normal(0, 6)</code> prior on your <span class="math inline">\(\beta\)</span> parameters will be nearly flat within the reasonable neighborhoods of the parameter space.</p>
</div>
<div id="but-logs-are-hard." class="section level2">
<h2>But logs are hard.</h2>
<p>If we approach our Bayesian power analysis from a precision perspective, it can be difficult to settle on a reasonable interval width when they’re on the log scale. So let’s modify our simulation flow so it converts the width summaries back into the natural metric. Before we go big, let’s practice with a single iteration.</p>
<pre class="r"><code>seed &lt;- 0
set.seed(seed)

# simulate the data
d &lt;-
  tibble(high  = rep(0:1, each = n),
         count = c(rpois(n = n, lambda = mu_7),
                   rpois(n = n, lambda = mu_8)))

# fit the model
fit2 &lt;-
  update(fit1,
       newdata = d,
       seed = seed) </code></pre>
<p>Now summarize.</p>
<pre class="r"><code>library(tidybayes)

fit2 %&gt;% 
  posterior_samples() %&gt;% 
  transmute(`beta_1` = exp(b_high)) %&gt;% 
  mean_qi()</code></pre>
<pre><code>##     beta_1   .lower   .upper .width .point .interval
## 1 2.686121 2.195825 3.299118   0.95   mean        qi</code></pre>
<p>Before we used the handy <code>broom::tidy()</code> function to extract our intervals, which took the brms fit object as input. Here we took a different approach. Because we are transforming <span class="math inline">\(\beta_1\)</span>, we used the <code>posterior_samples()</code> function to work directly with the posterior draws. We then exponentiated within <code>transmute()</code>, which returned a single-column tibble, not a brms fit object. So instead of <code>broom::tidy()</code>, it’s easier to get our summary statistics with the <code>tidybayes::mean_qi()</code> function. Do note that now our lower and upper levels are named <code>.lower</code> and <code>.upper</code>, respectively (i.e., they now have a <code>.</code> prefix).</p>
<p>Now we’ve practiced with the new flow, let’s redefine our simulation function.</p>
<pre class="r"><code>sim_data_fit &lt;- function(seed, n) {
  
  # define our mus in the function
  mu_7 &lt;- 2.17
  mu_8 &lt;- 6.25

  # make your results reproducible
  set.seed(seed)
  
  # simulate the data
  d &lt;-
    tibble(high  = rep(0:1, each = n),
           count = c(rpois(n = n, lambda = mu_7),
                     rpois(n = n, lambda = mu_8)))
  
  # fit and summarize
  update(fit1,
         newdata = d,
         seed = seed) %&gt;% 
  posterior_samples() %&gt;% 
  transmute(`beta_1` = exp(b_high)) %&gt;% 
  mean_qi()
  
}</code></pre>
<p>Simulate.</p>
<pre class="r"><code>sim3 &lt;-
  tibble(seed = 1:100) %&gt;% 
  mutate(ci = map(seed, sim_data_fit, n = 50)) %&gt;% 
  unnest()</code></pre>
<p>Here’s what those 100 <span class="math inline">\(\beta_1\)</span> intervals look like in bulk.</p>
<pre class="r"><code>sim3 %&gt;% 
  ggplot(aes(x = seed, y = beta_1, ymin = .lower, ymax = .upper)) +
  geom_hline(yintercept = 0, color = &quot;white&quot;) +
  geom_pointrange(fatten = 1) +
  labs(x = &quot;seed (i.e., simulation index)&quot;,
       y = expression(beta[1]))</code></pre>
<p><img src="/post/2019-08-11-bayesian-power-analysis-part-iii-a_files/figure-html/unnamed-chunk-17-1.png" width="768" /></p>
<p>Inspect the distribution of their widths.</p>
<pre class="r"><code>sim3 %&gt;% 
  mutate(width = .upper - .lower) %&gt;% 
  
  ggplot(aes(x = width)) +
  geom_histogram(binwidth = 0.05)</code></pre>
<p><img src="/post/2019-08-11-bayesian-power-analysis-part-iii-a_files/figure-html/unnamed-chunk-18-1.png" width="384" /></p>
<p>What if we wanted a mean 95% interval width of 1? Let’s run the simulation again, this time with <span class="math inline">\(n = 100\)</span>.</p>
<pre class="r"><code>sim4 &lt;-
  tibble(seed = 1:100) %&gt;% 
  mutate(ci = map(seed, sim_data_fit, n = 100)) %&gt;% 
  unnest() %&gt;% 
  mutate(width = .upper - .lower)</code></pre>
<p>Here’s the new width distribution.</p>
<pre class="r"><code>sim4 %&gt;% 
  ggplot(aes(x = width)) +
  geom_histogram(binwidth = 0.05)</code></pre>
<p><img src="/post/2019-08-11-bayesian-power-analysis-part-iii-a_files/figure-html/unnamed-chunk-19-1.png" width="384" /></p>
<p>And the mean width is:</p>
<pre class="r"><code>sim4 %&gt;% 
  summarise(mean_width = mean(width))</code></pre>
<pre><code>## # A tibble: 1 x 1
##   mean_width
##        &lt;dbl&gt;
## 1      0.912</code></pre>
<p>Nice! If we want a mean width of 1, it looks like we’re a little <em>overpowered</em> with <span class="math inline">\(n = 100\)</span>. The next step would be to up your iterations to 1000 or so to do a proper simulation.</p>
<p>Now you’ve got a sense of how to work with the Poisson likelihood, next time we’ll play with binary data.</p>
</div>
<div id="session-info" class="section level2">
<h2>Session info</h2>
<pre class="r"><code>sessionInfo()</code></pre>
<pre><code>## R version 3.6.0 (2019-04-26)
## Platform: x86_64-apple-darwin15.6.0 (64-bit)
## Running under: macOS High Sierra 10.13.6
## 
## Matrix products: default
## BLAS:   /Library/Frameworks/R.framework/Versions/3.6/Resources/lib/libRblas.0.dylib
## LAPACK: /Library/Frameworks/R.framework/Versions/3.6/Resources/lib/libRlapack.dylib
## 
## locale:
## [1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8
## 
## attached base packages:
## [1] stats     graphics  grDevices utils     datasets  methods   base     
## 
## other attached packages:
##  [1] tidybayes_1.1.0 broom_0.5.2     brms_2.9.0      Rcpp_1.0.1     
##  [5] forcats_0.4.0   stringr_1.4.0   dplyr_0.8.1     purrr_0.3.2    
##  [9] readr_1.3.1     tidyr_0.8.3     tibble_2.1.3    ggplot2_3.2.0  
## [13] tidyverse_1.2.1
## 
## loaded via a namespace (and not attached):
##   [1] colorspace_1.4-1          ggridges_0.5.1           
##   [3] rsconnect_0.8.13          ggstance_0.3.2           
##   [5] markdown_1.0              base64enc_0.1-3          
##   [7] rstudioapi_0.10           rstan_2.18.2             
##   [9] svUnit_0.7-12             DT_0.7                   
##  [11] fansi_0.4.0               mvtnorm_1.0-11           
##  [13] lubridate_1.7.4           xml2_1.2.0               
##  [15] bridgesampling_0.6-0      codetools_0.2-16         
##  [17] knitr_1.23                shinythemes_1.1.2        
##  [19] zeallot_0.1.0             bayesplot_1.7.0          
##  [21] jsonlite_1.6              shiny_1.3.2              
##  [23] compiler_3.6.0            httr_1.4.0               
##  [25] backports_1.1.4           assertthat_0.2.1         
##  [27] Matrix_1.2-17             lazyeval_0.2.2           
##  [29] cli_1.1.0                 later_0.8.0              
##  [31] htmltools_0.3.6           prettyunits_1.0.2        
##  [33] tools_3.6.0               igraph_1.2.4.1           
##  [35] coda_0.19-2               gtable_0.3.0             
##  [37] glue_1.3.1                reshape2_1.4.3           
##  [39] cellranger_1.1.0          vctrs_0.1.0              
##  [41] nlme_3.1-139              blogdown_0.14            
##  [43] crosstalk_1.0.0           xfun_0.8                 
##  [45] ps_1.3.0                  rvest_0.3.4              
##  [47] mime_0.7                  miniUI_0.1.1.1           
##  [49] gtools_3.8.1              zoo_1.8-6                
##  [51] scales_1.0.0              colourpicker_1.0         
##  [53] hms_0.4.2                 promises_1.0.1           
##  [55] Brobdingnag_1.2-6         parallel_3.6.0           
##  [57] inline_0.3.15             shinystan_2.5.0          
##  [59] yaml_2.2.0                gridExtra_2.3            
##  [61] loo_2.1.0                 StanHeaders_2.18.1-10    
##  [63] stringi_1.4.3             dygraphs_1.1.1.6         
##  [65] pkgbuild_1.0.3            rlang_0.4.0              
##  [67] pkgconfig_2.0.2           matrixStats_0.54.0       
##  [69] evaluate_0.14             lattice_0.20-38          
##  [71] rstantools_1.5.1          htmlwidgets_1.3          
##  [73] labeling_0.3              tidyselect_0.2.5         
##  [75] processx_3.3.1            plyr_1.8.4               
##  [77] magrittr_1.5              bookdown_0.12            
##  [79] R6_2.4.0                  generics_0.0.2           
##  [81] pillar_1.4.1              haven_2.1.0              
##  [83] withr_2.1.2               xts_0.11-2               
##  [85] abind_1.4-5               modelr_0.1.4             
##  [87] crayon_1.3.4              arrayhelpers_1.0-20160527
##  [89] utf8_1.1.4                rmarkdown_1.13           
##  [91] grid_3.6.0                readxl_1.3.1             
##  [93] callr_3.2.0               threejs_0.3.1            
##  [95] digest_0.6.19             xtable_1.8-4             
##  [97] httpuv_1.5.1              stats4_3.6.0             
##  [99] munsell_0.5.0             shinyjs_1.0</code></pre>
</div>
<div id="footnote" class="section level2">
<h2>Footnote</h2>
</div>
<div class="footnotes">
<hr />
<ol>
<li id="fn1"><p>Yes, one can smoke half a cigarette or drink 1/3 of a drink. Ideally, we’d have the exact amount of nicotine in your blood at a given moment and over time and the same for the amount of alcohol in your system relative to your blood volume and such. But in practice, substance use researchers just don’t tend to have access to data of that quality. Instead, we’re typically stuck with simple counts. And I look forward to the day the right team of engineers, computer scientists, and substance use researchers (and whoever else I forgot to mention) release the cheap, non-invasive technology we need to passively measure these things. Until then: <em>How many standard servings of alcohol did you drink, last night?</em><a href="#fnref1" class="footnote-back">↩</a></p></li>
</ol>
</div>

    </div>

    


<div class="article-tags">
  
  <a class="badge badge-light" href="/tags/bayesian/">Bayesian</a>
  
  <a class="badge badge-light" href="/tags/power/">power</a>
  
  <a class="badge badge-light" href="/tags/r/">R</a>
  
  <a class="badge badge-light" href="/tags/tidyverse/">tidyverse</a>
  
  <a class="badge badge-light" href="/tags/tutorial/">tutorial</a>
  
</div>




    
    
    <div class="article-widget">
      <div class="hr-light"></div>
      <h3>Related</h3>
      <ul>
        
        <li><a href="/post/bayesian-power-analysis-part-ii/">Bayesian power analysis: Part II. Some might prefer precision to power</a></li>
        
        <li><a href="/post/bayesian-power-analysis-part-i/">Bayesian power analysis: Part I. Prepare to reject $H_0$ with simulation.</a></li>
        
        <li><a href="/post/would-you-like-all-your-posteriors-in-one-plot/">Would you like all your posteriors in one plot?</a></li>
        
        <li><a href="/post/stein-s-paradox-and-what-partial-pooling-can-do-for-you/">Stein’s Paradox and What Partial Pooling Can Do For You</a></li>
        
        <li><a href="/post/bayesian-correlations-let-s-talk-options/">Bayesian Correlations: Let’s Talk Options.</a></li>
        
      </ul>
    </div>
    

    

    


  </div>
</article>

<div class="container">
  <footer class="site-footer">
  
  <p class="powered-by">
    <a href="/privacy/">Privacy Policy</a>
  </p>
  

  <p class="powered-by">
    &copy; 2018 &middot; 

    Powered by the
    <a href="https://sourcethemes.com/academic/" target="_blank" rel="noopener">Academic theme</a> for
    <a href="https://gohugo.io" target="_blank" rel="noopener">Hugo</a>.

    
    <span class="float-right" aria-hidden="true">
      <a href="#" id="back_to_top">
        <span class="button_icon">
          <i class="fas fa-chevron-up fa-2x"></i>
        </span>
      </a>
    </span>
    
  </p>
</footer>

</div>


<div id="modal" class="modal fade" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Cite</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <pre><code class="tex hljs"></code></pre>
      </div>
      <div class="modal-footer">
        <a class="btn btn-outline-primary my-1 js-copy-cite" href="#" target="_blank">
          <i class="fas fa-copy"></i> Copy
        </a>
        <a class="btn btn-outline-primary my-1 js-download-cite" href="#" target="_blank">
          <i class="fas fa-download"></i> Download
        </a>
        <div id="modal-error"></div>
      </div>
    </div>
  </div>
</div>

    

    
    
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        CommonHTML: { linebreaks: { automatic: true } },
        tex2jax: { inlineMath: [ ['$', '$'], ['\\(','\\)'] ], displayMath: [ ['$$','$$'], ['\\[', '\\]'] ], processEscapes: false },
        TeX: { noUndefined: { attributes: { mathcolor: 'red', mathbackground: '#FFEEEE', mathsize: '90%' } } },
        messageStyle: 'none'
      });
    </script>
    

    
    
    
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha512-+NqPlbbtM1QqiK8ZAo4Yrj2c4lNQoGv8P79DPtKzj++l5jnN39rHA/xsqn8zE9l0uSoxaCdrOgFs6yjyfbBxSg==" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/4.1.3/imagesloaded.pkgd.min.js" integrity="sha512-umsR78NN0D23AzgoZ11K7raBD+R6hqKojyBZs1w8WvYlsI+QuKRGBx3LFCwhatzBunCjDuJpDHwxD13sLMbpRA==" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha256-VsEqElsCHSGmnmHXGQzvoWjWwoznFSZc6hs7ARLRacQ=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.isotope/3.0.4/isotope.pkgd.min.js" integrity="sha512-VDBOIlDbuC4VWxGJNmuFRQ0Li0SKkDpmGyuhAG5LTDLd/dJ/S0WMVxriR2Y+CyPL5gzjpN4f/6iqWVBJlht0tQ==" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.2.5/jquery.fancybox.min.js" integrity="sha256-X5PoE3KU5l+JcX+w09p/wHl9AzK333C4hJ2I9S5mD4M=" crossorigin="anonymous"></script>

      
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js" integrity="sha256-/BfiIkHlHoVihZdc6TFuj7MmJ0TWcWsMXkeDFwhi0zw=" crossorigin="anonymous"></script>
        
      

      
      
      <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=TeX-AMS_CHTML-full" integrity="sha256-GhM+5JHb6QUzOQPXSJLEWP7R73CbkisjzK5Eyij4U9w=" crossorigin="anonymous" async></script>
      
    

    <script src="/js/hugo-academic.js"></script>
    

    
    

    
    
    

    
    
    <script>hljs.initHighlightingOnLoad();</script>
    

    
    
    <script>
      const search_index_filename = "/index.json";
      const i18n = {
        'placeholder': "Search...",
        'results': "Search Results",
        'no_results': "No results found"
      };
      const content_type = {
        'post': "Posts",
        'project': "Projects",
        'publication' : "Publications",
        'talk' : "Talks"
        };
    </script>
    

    
    

    
    
    <script id="search-hit-fuse-template" type="text/x-template">
      <div class="search-hit" id="summary-{{key}}">
      <div class="search-hit-content">
        <div class="search-hit-name">
          <a href="{{relpermalink}}">{{title}}</a>
          <div class="article-metadata search-hit-type">{{type}}</div>
          <p class="search-hit-description">{{snippet}}</p>
        </div>
      </div>
      </div>
    </script>
    

    
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/3.2.1/fuse.min.js" integrity="sha256-VzgmKYmhsGNNN4Ph1kMW+BjoYJM2jV5i4IlFoeZA9XI=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script>
    <script src="/js/search.js"></script>
    

    
    

  </body>
</html>

